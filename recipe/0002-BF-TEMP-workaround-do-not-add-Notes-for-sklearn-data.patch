From 135c808ff92ed785f12e35e05936a06b27db657b Mon Sep 17 00:00:00 2001
From: Yaroslav Halchenko <debian@onerussian.com>
Date: Tue, 26 Jun 2018 13:49:41 -0400
Subject: [PATCH 2/4] BF(TEMP workaround): do not add Notes for sklearn
 datasets if doc already has Notes

Otherwise sphinx blows
---
 mvpa2/datasets/sources/skl_data.py | 18 +++++++++++++-----
 1 file changed, 13 insertions(+), 5 deletions(-)

diff --git a/mvpa2/datasets/sources/skl_data.py b/mvpa2/datasets/sources/skl_data.py
index 0595a446..9f17321b 100644
--- a/mvpa2/datasets/sources/skl_data.py
+++ b/mvpa2/datasets/sources/skl_data.py
@@ -52,10 +52,13 @@ if externals.exists('skl', raise_=True):
             sig += '**%s' % varkw
 
         pymvpa_fxname = 'skl_%s' % fx.__name__[5:]
-        fxdef = '''
-def %s(%s):
-    """%s
-
+        if 'Notes' in fx.__doc__:
+            # There must be no 2 Notes sections. TODO: we would need to
+            # locate it and add our section.  Some times it is a section
+            # in the middle before References etc
+            notes_sec = ''
+        else:
+            notes_sec = """
     Notes
     -----
     This function has been auto-generated by wrapping %s() from the
@@ -63,6 +66,11 @@ def %s(%s):
     this function has been kept verbatim. Consequently, the actual return
     value is not as described in the documentation, but the data is returned
     as a PyMVPA dataset.
+""" % fx.__name__
+        fxdef = '''
+def %s(%s):
+    """%s
+    %s
     """
     from sklearn import datasets as sklds
     from mvpa2.datasets import Dataset
@@ -89,7 +97,7 @@ def %s(%s):
 ''' % (pymvpa_fxname,
                sig,
                fx.__doc__,
-               fx.__name__,
+               notes_sec,
                fx.__name__,
                ', '.join(argnames))
         exec fxdef
-- 
2.17.0

